"use strict";(()=>{var a={};a.id=211,a.ids=[211],a.modules={7476:a=>{a.exports=require("@libsql/client")},2934:a=>{a.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:a=>{a.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:a=>{a.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:a=>{a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:a=>{a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9491:a=>{a.exports=require("assert")},4300:a=>{a.exports=require("buffer")},6113:a=>{a.exports=require("crypto")},358:a=>{a.exports=require("fs")},2781:a=>{a.exports=require("stream")},3837:a=>{a.exports=require("util")},9796:a=>{a.exports=require("zlib")},8032:(a,t,e)=>{e.r(t),e.d(t,{originalPathname:()=>w,patchFetch:()=>S,requestAsyncStorage:()=>N,routeModule:()=>m,serverHooks:()=>p,staticGenerationAsyncStorage:()=>R});var n={};e.r(n),e.d(n,{GET:()=>l,runtime:()=>d});var i=e(9303),r=e(8716),s=e(670),o=e(7070),E=e(8362),c=e(1615),u=e(9178),T=e(9487);let d="nodejs";async function l(a){if(!(0,u.D3)())return new o.NextResponse("Unauthorized",{status:401});let t=await (0,T.Yl)("prayer-display");if(!t)return new o.NextResponse("Not found",{status:404});let e=new URL(a.url).searchParams.get("lang"),n=`/display/prayer/${t.token}${"bn"===e?"?lang=bn":""}`,i=`${function(){let a=(0,c.headers)(),t=a.get("x-forwarded-proto")??"http",e=a.get("x-forwarded-host")??a.get("host")??"localhost:3000";return`${t}://${e}`}()}${n}`,r=await E.toBuffer(i,{width:512,margin:1});return new o.NextResponse(new Uint8Array(r),{status:200,headers:{"Content-Type":"image/png","Cache-Control":"no-store"}})}let m=new i.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/admin/(dashboard)/displays/prayer/qr/route",pathname:"/admin/displays/prayer/qr",filename:"route",bundlePath:"app/admin/(dashboard)/displays/prayer/qr/route"},resolvedPagePath:"/Users/nabilrt/Desktop/baitun-najat/app/admin/(dashboard)/displays/prayer/qr/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:N,staticGenerationAsyncStorage:R,serverHooks:p}=m,w="/admin/(dashboard)/displays/prayer/qr/route";function S(){return(0,s.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:R})}},9178:(a,t,e)=>{e.d(t,{D3:()=>d,NK:()=>m,RB:()=>T,mN:()=>l});var n=e(6113),i=e.n(n),r=e(1615);let s=process.env.ADMIN_USER||"admin",o=process.env.ADMIN_PASS||"baitun-najat",E=process.env.ADMIN_SECRET||"dev-secret-change-me",c="baitun_najat_admin";function u(a){return i().createHmac("sha256",E).update(a).digest("base64url")}function T(a,t){return a===s&&t===o}function d(){return function(a){if(!a)return!1;let[t,e]=a.split(".");if(!t||!e)return!1;let n=u(t);if(e.length!==n.length||!i().timingSafeEqual(Buffer.from(e),Buffer.from(n)))return!1;try{return JSON.parse(Buffer.from(t,"base64url").toString("utf8")).exp>Date.now()}catch{return!1}}(r.cookies().get(c)?.value)}function l(){let a=function(){var a;let t=(a=JSON.stringify({exp:Date.now()+432e5}),Buffer.from(a).toString("base64url")),e=u(t);return`${t}.${e}`}();(0,r.cookies)().set(c,a,{httpOnly:!0,sameSite:"lax",secure:!0,maxAge:43200,path:"/"})}function m(){(0,r.cookies)().set(c,"",{httpOnly:!0,sameSite:"lax",secure:!0,maxAge:0,path:"/"})}},9487:(a,t,e)=>{e.d(t,{AA:()=>f,Ec:()=>h,Hf:()=>x,Ho:()=>H,LD:()=>g,N3:()=>O,NR:()=>b,OH:()=>m,Or:()=>U,PS:()=>F,QF:()=>I,Qs:()=>A,U0:()=>w,UQ:()=>_,Yl:()=>C,Zc:()=>X,Ze:()=>N,Zl:()=>y,_5:()=>k,_c:()=>M,_z:()=>v,cQ:()=>R,ct:()=>L,dB:()=>D,nH:()=>S,vj:()=>P,yq:()=>p});var n=e(7476),i=e(6113),r=e.n(i);let s=null,o=null;async function E(a,t=[]){return(function(){if(!s){let a=process.env.TURSO_URL||"file:./data/baitun-najat.db",t=process.env.TURSO_AUTH_TOKEN;s=(0,n.createClient)({url:a,authToken:t})}return s})().execute({sql:a,args:t})}function c(a){return a.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,"")}async function u(a){let t=c(a)||"campaign",e=t,n=1;for(;;){let a=await E("SELECT COUNT(*) as count FROM campaigns WHERE slug = ?",[e]);if(0===Number(a.rows[0]?.count??0))return e;e=`${t}-${n}`,n+=1}}async function T(){for(;;){let a=r().randomBytes(8).toString("base64url"),t=await E("SELECT COUNT(*) as count FROM campaigns WHERE share_token = ?",[a]);if(0===Number(t.rows[0]?.count??0))return a}}async function d(){return o||(o=(async()=>{for(let a of[`CREATE TABLE IF NOT EXISTS prayer_times (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        name_bn TEXT,
        azan_time TEXT NOT NULL,
        prayer_time TEXT NOT NULL
      )`,`CREATE TABLE IF NOT EXISTS hadiths (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        text TEXT NOT NULL,
        source TEXT NOT NULL,
        created_at TEXT NOT NULL
      )`,`CREATE TABLE IF NOT EXISTS donations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        amount INTEGER NOT NULL,
        bkash_number TEXT NOT NULL,
        transaction_id TEXT NOT NULL,
        note TEXT,
        campaign_id INTEGER,
        created_at TEXT NOT NULL,
        confirmed INTEGER NOT NULL DEFAULT 0,
        confirmed_at TEXT,
        FOREIGN KEY (campaign_id) REFERENCES campaigns(id)
      )`,`CREATE TABLE IF NOT EXISTS campaigns (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        title TEXT NOT NULL,
        description TEXT NOT NULL,
        goal_amount INTEGER,
        slug TEXT,
        share_token TEXT,
        is_active INTEGER NOT NULL DEFAULT 1,
        created_at TEXT NOT NULL,
        archived_at TEXT
      )`,`CREATE TABLE IF NOT EXISTS announcements (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        title TEXT NOT NULL,
        title_bn TEXT,
        message TEXT NOT NULL,
        message_bn TEXT,
        start_at TEXT NOT NULL,
        end_at TEXT NOT NULL,
        is_active INTEGER NOT NULL DEFAULT 1,
        created_at TEXT NOT NULL
      )`,`CREATE TABLE IF NOT EXISTS display_links (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        slug TEXT NOT NULL,
        token TEXT NOT NULL,
        created_at TEXT NOT NULL
      )`])await E(a);let a=await E("SELECT COUNT(*) as count FROM prayer_times");if(0===Number(a.rows[0]?.count??0))for(let a of[["Fajr","ফজর","04:20 AM","04:35 AM"],["Dhuhr","যোহর","12:40 PM","12:55 PM"],["Asr","আসর","04:30 PM","04:45 PM"],["Maghrib","মাগরিব","06:25 PM","06:30 PM"],["Isha","এশা","07:45 PM","08:00 PM"],["Jumu'ah","জুমুআ","01:05 PM","01:30 PM"]])await E("INSERT INTO prayer_times (name, name_bn, azan_time, prayer_time) VALUES (?, ?, ?, ?)",a);let t=await E("SELECT COUNT(*) as count FROM hadiths");if(0===Number(t.rows[0]?.count??0)){let a=new Date().toISOString();for(let t of[["The most beloved deeds to Allah are those that are consistent, even if small.","Sahih al-Bukhari 6464"],["The best among you are those who learn the Qur'an and teach it.","Sahih al-Bukhari 5027"],["Whoever builds a mosque for Allah, Allah will build for him a house in Paradise.","Sahih Muslim 533"]])await E("INSERT INTO hadiths (text, source, created_at) VALUES (?, ?, ?)",[t[0],t[1],a])}let e=await E("SELECT COUNT(*) as count FROM campaigns");if(0===Number(e.rows[0]?.count??0)){let a=new Date().toISOString();for(let t of[["Renovation & Prayer Hall Upgrade","Help us renovate the main prayer hall, improve lighting, and replace worn carpets.",15e4],["Qur'an Learning Support","Support our evening Qur'an classes with books, materials, and teacher honorariums.",6e4]]){let e=c(String(t[0])),n=await T();await E("INSERT INTO campaigns (title, description, goal_amount, slug, share_token, is_active, created_at) VALUES (?, ?, ?, ?, ?, 1, ?)",[t[0],t[1],t[2],e,n,a])}}for(let a of(await E("SELECT id, title FROM campaigns WHERE slug IS NULL OR slug = ''")).rows){let t=await u(String(a.title));await E("UPDATE campaigns SET slug = ? WHERE id = ?",[t,a.id])}for(let a of(await E("SELECT id FROM campaigns WHERE share_token IS NULL OR share_token = ''")).rows){let t=await T();await E("UPDATE campaigns SET share_token = ? WHERE id = ?",[t,a.id])}let n=await E("SELECT id, name FROM prayer_times WHERE name_bn IS NULL OR name_bn = ''"),i={Fajr:"ফজর",Dhuhr:"যোহর",Asr:"আসর",Maghrib:"মাগরিব",Isha:"এশা","Jumu'ah":"জুমুআ"};for(let a of n.rows){let t=String(a.name);await E("UPDATE prayer_times SET name_bn = ? WHERE id = ?",[i[t]??t,a.id])}let r=await E("SELECT COUNT(*) as count FROM display_links WHERE slug = 'prayer-display'");if(0===Number(r.rows[0]?.count??0)){let a=await l(),t=new Date().toISOString();await E("INSERT INTO display_links (slug, token, created_at) VALUES (?, ?, ?)",["prayer-display",a,t])}})())}async function l(){for(;;){let a=r().randomBytes(8).toString("base64url"),t=await E("SELECT COUNT(*) as count FROM display_links WHERE token = ?",[a]);if(0===Number(t.rows[0]?.count??0))return a}}async function m(){return await d(),(await E("SELECT * FROM prayer_times ORDER BY id")).rows}async function N(a,t,e,n){await d(),await E("UPDATE prayer_times SET name_bn = ?, azan_time = ?, prayer_time = ? WHERE id = ?",[t,e,n,a])}async function R(){return await d(),(await E("SELECT * FROM hadiths ORDER BY created_at DESC")).rows}async function p(a,t){await d();let e=new Date().toISOString();await E("INSERT INTO hadiths (text, source, created_at) VALUES (?, ?, ?)",[a,t,e])}async function w(a){await d(),await E("DELETE FROM hadiths WHERE id = ?",[a])}async function S(a){await d();let t=new Date().toISOString();await E("INSERT INTO donations (name, amount, bkash_number, transaction_id, note, campaign_id, created_at, confirmed) VALUES (?, ?, ?, ?, ?, ?, ?, 0)",[a.name,a.amount,a.bkashNumber,a.transactionId,a.note??null,a.campaignId??null,t])}async function O(a){await d();let t=new Date().toISOString();await E("INSERT INTO donations (name, amount, bkash_number, transaction_id, note, campaign_id, created_at, confirmed, confirmed_at) VALUES (?, ?, ?, ?, ?, ?, ?, 1, ?)",[a.name,a.amount,a.bkashNumber,a.transactionId,a.note??null,a.campaignId??null,t,t])}async function f(){return await d(),(await E("SELECT * FROM donations WHERE confirmed = 1 ORDER BY confirmed_at DESC, created_at DESC")).rows}async function _(){return await d(),(await E("SELECT * FROM donations WHERE confirmed = 0 ORDER BY created_at DESC")).rows}async function L(a){await d();let t=new Date().toISOString();await E("UPDATE donations SET confirmed = 1, confirmed_at = ? WHERE id = ?",[t,a])}async function g(){return await d(),(await E("SELECT * FROM campaigns WHERE is_active = 1 ORDER BY created_at DESC")).rows}async function h(a){await d();let t=new Date().toISOString(),e=await u(a.title),n=await T();await E("INSERT INTO campaigns (title, description, goal_amount, slug, share_token, is_active, created_at) VALUES (?, ?, ?, ?, ?, 1, ?)",[a.title,a.description,a.goalAmount??null,e,n,t])}async function y(a){await d();let t=new Date().toISOString();await E("UPDATE campaigns SET is_active = 0, archived_at = ? WHERE id = ?",[t,a])}async function U(a){await d(),await E("UPDATE campaigns SET is_active = 1, archived_at = NULL WHERE id = ?",[a])}async function I(a){return await d(),(await E("SELECT * FROM campaigns WHERE id = ?",[a])).rows[0]??null}async function A(a){return await d(),(await E("SELECT * FROM campaigns WHERE share_token = ?",[a])).rows[0]??null}async function C(a){return await d(),(await E("SELECT * FROM display_links WHERE slug = ?",[a])).rows[0]??null}async function M(a){return await d(),(await E("SELECT * FROM display_links WHERE token = ?",[a])).rows[0]??null}async function D(){return await d(),(await E(`SELECT c.*, COALESCE(SUM(d.amount), 0) as total_confirmed
     FROM campaigns c
     LEFT JOIN donations d ON d.campaign_id = c.id AND d.confirmed = 1
     WHERE c.is_active = 1
     GROUP BY c.id
     ORDER BY c.created_at DESC`)).rows}async function b(){return await d(),(await E(`SELECT c.*, COALESCE(SUM(d.amount), 0) as total_confirmed
     FROM campaigns c
     LEFT JOIN donations d ON d.campaign_id = c.id AND d.confirmed = 1
     GROUP BY c.id
     ORDER BY c.created_at DESC`)).rows}async function F(a){return await d(),(await E(`SELECT c.*, COALESCE(SUM(d.amount), 0) as total_confirmed
     FROM campaigns c
     LEFT JOIN donations d ON d.campaign_id = c.id AND d.confirmed = 1
     WHERE c.slug = ?
     GROUP BY c.id`,[a])).rows[0]??null}async function v(a){return await d(),(await E(`SELECT * FROM announcements
     WHERE is_active = 1 AND start_at <= ? AND end_at >= ?
     ORDER BY start_at DESC`,[a,a])).rows}async function x(){return await d(),(await E("SELECT * FROM announcements ORDER BY created_at DESC")).rows}async function P(a){await d();let t=new Date().toISOString();await E("INSERT INTO announcements (title, title_bn, message, message_bn, start_at, end_at, is_active, created_at) VALUES (?, ?, ?, ?, ?, ?, 1, ?)",[a.title,a.titleBn??null,a.message,a.messageBn??null,a.startAt,a.endAt,t])}async function H(a){await d(),await E("UPDATE announcements SET is_active = 0 WHERE id = ?",[a])}async function X(a){await d(),await E("UPDATE announcements SET is_active = 1 WHERE id = ?",[a])}async function k(a){await d(),await E("DELETE FROM announcements WHERE id = ?",[a])}}};var t=require("../../../../../../webpack-runtime.js");t.C(a);var e=a=>t(t.s=a),n=t.X(0,[948,615,362,945],()=>e(8032));module.exports=n})();